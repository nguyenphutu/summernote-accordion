<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Summernote Accordion</title>
  <!-- include libraries(jQuery, bootstrap) -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <!-- include summernote css/js -->
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.js"></script>
  <!-- import accordion plugin -->
  <script src="src/summernote-accordion.js"></script>
</head>

<body>
  <div class="container">
    <h1>Summernote Accordion</h1>
    <div style="background-color: #FFF" class="wrapper">
      <div id="summernote"></div>
    </div>
  </div>

  <!-- Accordion Modal -->
  <div class="modal fade" id="accordionModal" tabindex="-1" role="dialog" aria-labelledby="accordionModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form id="accordionForm">
          <div class="modal-header">
            <h4 class="modal-title" id="accordionModalLabel">Thêm Accordion</h4>
          </div>
          <div class="modal-body">
            <div id="accordion-items">
              <div class="panel panel-default accordion-item">
                <div class="panel-heading">
                  <input type="text" class="form-control" name="title[]" placeholder="Tiêu đề mục Accordion" required>
                </div>
                <div class="panel-body">
                  <textarea class="form-control" name="content[]" placeholder="Nội dung" required></textarea>
                </div>
              </div>
            </div>
            <button type="button" class="btn btn-default" id="addAccordionItem">+ Thêm mục</button>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Hủy</button>
            <button type="submit" class="btn btn-primary">Chèn Accordion</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Add/Remove Accordion Items
    $(document).on('click', '#addAccordionItem', function () {
      var item = $('#accordion-items .accordion-item:first').clone();
      item.find('input, textarea').val('');
      $('#accordion-items').append(item);
    });

    // Handle Accordion Form Submit
    $('#accordionForm').on('submit', function (e) {
      e.preventDefault();
      var titles = $("input[name='title[]']").map(function () { return $(this).val(); }).get();
      var contents = $("textarea[name='content[]']").map(function () { return $(this).val(); }).get();
      var accordionId = 'accordion-' + Date.now().toString(36);
      var html = '<div class="panel-group" id="' + accordionId + '" role="tablist" aria-multiselectable="true">';
      for (var i = 0; i < titles.length; i++) {
        var collapseId = accordionId + '-collapse' + i;
        html +=
          '<div class="panel panel-default">' +
          '<div class="panel-heading" role="tab" id="' + collapseId + '-heading" style="cursor:pointer;">' +
          '<h4 class="panel-title" style="margin:0;">' +
          // Đặt sự kiện vào panel-heading, link vẫn giữ nguyên để bootstrap hoạt động
          '<a class="accordion-toggle' + (i === 0 ? '' : ' collapsed') + '" data-toggle="collapse" data-parent="#' + accordionId + '" href="#' + collapseId + '" aria-expanded="' + (i === 0 ? 'true' : 'false') + '" aria-controls="' + collapseId + '" style="display:block; width:100%; text-decoration:none;">' +
          titles[i] +
          '</a>' +
          '</h4>' +
          '</div>' +
          '<div id="' + collapseId + '" class="panel-collapse collapse' + (i === 0 ? ' in' : '') + '" role="tabpanel" aria-labelledby="' + collapseId + '-heading">' +
          '<div class="panel-body">' + contents[i] + '</div>' +
          '</div>' +
          '</div>';
      }
      html += '</div>';
      $('#summernote').summernote('pasteHTML', html);
      $('#accordionModal').modal('hide');
      // Reset form
      $('#accordion-items').html($('#accordion-items .accordion-item:first').clone());
      $('#accordion-items .accordion-item input, #accordion-items .accordion-item textarea').val('');
    });

    // Summernote Init
    $('#summernote').summernote({
      height: 250,
      toolbar: [
        ['insert', ['picture', 'link', 'video', 'table', 'hr', 'accordion']],
        ['font style', ['fontname', 'fontsize', 'color', 'bold', 'italic',
          'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
        ['paragraph style', ['style', 'ol', 'ul', 'paragraph', 'height']],
        ['misc', ['fullscreen', 'codeview', 'undo', 'redo', 'help']],
        ['view', ['fullscreen', 'codeview', 'help']]
      ],
      buttons: {
        accordion: window.AccordionButton
      }
    });

    // Cho phép click vào panel-heading để toggle accordion
    $(document).on('click', '.panel-heading', function (e) {
      // Nếu click vào link thì để mặc định
      if ($(e.target).is('a')) return;
      var $toggle = $(this).find('a.accordion-toggle');
      if ($toggle.length) {
        $toggle.trigger('click');
      }
    });
  </script>
</body>

</html>